     1                                  %include 'in.out.asm'
     1                              <1> ; Подпрограмма вычисления длины строки
     2                              <1> slen:
     3 00000000 53                  <1>     push ebx
     4 00000001 89C3                <1>     mov ebx, eax
     5                              <1>     
     6                              <1> slen_nextchar:
     7 00000003 803800              <1>     cmp byte [eax], 0
     8 00000006 7403                <1>     jz slen_finished
     9 00000008 40                  <1>     inc eax
    10 00000009 EBF8                <1>     jmp slen_nextchar
    11                              <1>     
    12                              <1> slen_finished:
    13 0000000B 29D8                <1>     sub eax, ebx
    14 0000000D 5B                  <1>     pop ebx
    15 0000000E C3                  <1>     ret
    16                              <1> 
    17                              <1> ; Подпрограмма печати строки
    18                              <1> sprint:
    19 0000000F 52                  <1>     push edx
    20 00000010 51                  <1>     push ecx
    21 00000011 53                  <1>     push ebx
    22 00000012 50                  <1>     push eax
    23 00000013 E8E8FFFFFF          <1>     call slen
    24                              <1>     
    25 00000018 89C2                <1>     mov edx, eax
    26 0000001A 58                  <1>     pop eax
    27                              <1>     
    28 0000001B 89C1                <1>     mov ecx, eax
    29 0000001D BB01000000          <1>     mov ebx, 1
    30 00000022 B804000000          <1>     mov eax, 4
    31 00000027 CD80                <1>     int 80h
    32                              <1>     
    33 00000029 5B                  <1>     pop ebx
    34 0000002A 59                  <1>     pop ecx
    35 0000002B 5A                  <1>     pop edx
    36 0000002C C3                  <1>     ret
    37                              <1> 
    38                              <1> ; Подпрограмма печати строки с переводом строки
    39                              <1> sprintLF:
    40 0000002D 50                  <1>     push eax
    41 0000002E E8DCFFFFFF          <1>     call sprint
    42                              <1>     
    43 00000033 50                  <1>     push eax
    44 00000034 B80A000000          <1>     mov eax, 0Ah
    45 00000039 50                  <1>     push eax
    46 0000003A 89E0                <1>     mov eax, esp
    47 0000003C E8CEFFFFFF          <1>     call sprint
    48 00000041 58                  <1>     pop eax
    49 00000042 58                  <1>     pop eax
    50                              <1>     
    51 00000043 58                  <1>     pop eax
    52 00000044 C3                  <1>     ret
    53                              <1> 
    54                              <1> ; Подпрограмма чтения строки
    55                              <1> sread:
    56 00000045 51                  <1>     push ecx
    57 00000046 52                  <1>     push edx
    58 00000047 53                  <1>     push ebx
    59                              <1>     
    60 00000048 BA50000000          <1>     mov edx, 80
    61 0000004D 89C1                <1>     mov ecx, eax
    62 0000004F BB00000000          <1>     mov ebx, 0
    63 00000054 B803000000          <1>     mov eax, 3
    64 00000059 CD80                <1>     int 80h
    65                              <1>     
    66                              <1>     ; Добавляем нулевой байт в конец строки
    67 0000005B 89CE                <1>     mov esi, ecx
    68 0000005D 01C6                <1>     add esi, eax
    69 0000005F 4E                  <1>     dec esi
    70 00000060 C60600              <1>     mov byte [esi], 0
    71                              <1>     
    72 00000063 5B                  <1>     pop ebx
    73 00000064 5A                  <1>     pop edx
    74 00000065 59                  <1>     pop ecx
    75 00000066 C3                  <1>     ret
    76                              <1> 
    77                              <1> ; Подпрограмма вывода числа на экран
    78                              <1> iprint:
    79 00000067 50                  <1>     push eax
    80 00000068 51                  <1>     push ecx
    81 00000069 52                  <1>     push edx
    82 0000006A 56                  <1>     push esi
    83 0000006B B900000000          <1>     mov ecx, 0
    84                              <1>     
    85                              <1> iprint_divideLoop:
    86 00000070 41                  <1>     inc ecx
    87 00000071 BA00000000          <1>     mov edx, 0
    88 00000076 BE0A000000          <1>     mov esi, 10
    89 0000007B F7FE                <1>     idiv esi
    90 0000007D 83C230              <1>     add edx, 48
    91 00000080 52                  <1>     push edx
    92 00000081 83F800              <1>     cmp eax, 0
    93 00000084 75EA                <1>     jnz iprint_divideLoop
    94                              <1>     
    95                              <1> iprint_printLoop:
    96 00000086 49                  <1>     dec ecx
    97 00000087 89E0                <1>     mov eax, esp
    98 00000089 E881FFFFFF          <1>     call sprint
    99 0000008E 58                  <1>     pop eax
   100 0000008F 83F900              <1>     cmp ecx, 0
   101 00000092 75F2                <1>     jnz iprint_printLoop
   102                              <1>     
   103 00000094 5E                  <1>     pop esi
   104 00000095 5A                  <1>     pop edx
   105 00000096 59                  <1>     pop ecx
   106 00000097 58                  <1>     pop eax
   107 00000098 C3                  <1>     ret
   108                              <1> 
   109                              <1> ; Подпрограмма вывода числа с переводом строки
   110                              <1> iprintLF:
   111 00000099 E8C9FFFFFF          <1>     call iprint
   112 0000009E 50                  <1>     push eax
   113 0000009F B80A000000          <1>     mov eax, 0Ah
   114 000000A4 50                  <1>     push eax
   115 000000A5 89E0                <1>     mov eax, esp
   116 000000A7 E863FFFFFF          <1>     call sprint
   117 000000AC 58                  <1>     pop eax
   118 000000AD 58                  <1>     pop eax
   119 000000AE C3                  <1>     ret
   120                              <1> 
   121                              <1> ; Подпрограмма преобразования строки в число
   122                              <1> atoi:
   123 000000AF 53                  <1>     push ebx
   124 000000B0 51                  <1>     push ecx
   125 000000B1 52                  <1>     push edx
   126 000000B2 56                  <1>     push esi
   127 000000B3 89C6                <1>     mov esi, eax
   128 000000B5 B800000000          <1>     mov eax, 0
   129 000000BA B900000000          <1>     mov ecx, 0
   130                              <1>     
   131                              <1> atoi_loop:
   132 000000BF 31DB                <1>     xor ebx, ebx
   133 000000C1 8A1C0E              <1>     mov bl, [esi+ecx]
   134 000000C4 80FB30              <1>     cmp bl, 48
   135 000000C7 7C14                <1>     jl atoi_finished
   136 000000C9 80FB39              <1>     cmp bl, 57
   137 000000CC 7F0F                <1>     jg atoi_finished
   138 000000CE 80EB30              <1>     sub bl, 48
   139 000000D1 BA0A000000          <1>     mov edx, 10
   140 000000D6 F7E2                <1>     mul edx
   141 000000D8 01D8                <1>     add eax, ebx
   142 000000DA 41                  <1>     inc ecx
   143 000000DB EBE2                <1>     jmp atoi_loop
   144                              <1>     
   145                              <1> atoi_finished:
   146 000000DD 5E                  <1>     pop esi
   147 000000DE 5A                  <1>     pop edx
   148 000000DF 59                  <1>     pop ecx
   149 000000E0 5B                  <1>     pop ebx
   150 000000E1 C3                  <1>     ret
   151                              <1> 
   152                              <1> ; Подпрограмма завершения программы
   153                              <1> quit:
   154 000000E2 BB00000000          <1>     mov ebx, 0
   155 000000E7 B801000000          <1>     mov eax, 1
   156 000000EC CD80                <1>     int 80h
   157 000000EE C3                  <1>     ret
     2                                  SECTION .data
     3 00000000 726561646D652D312E-     filename db 'readme-1.txt', 8h
     3 00000009 74787408           
     4 0000000D D092D0B2D0B5D0B4D0-     msg db 'Введите строку для записи в файл: ', 8h
     4 00000016 B8D182D0B520D181D1-
     4 0000001F 82D180D0BED0BAD183-
     4 00000028 20D0B4D0BBD18F20D0-
     4 00000031 B7D0B0D0BFD0B8D181-
     4 0000003A D0B820D0B220D184D0-
     4 00000043 B0D0B9D0BB3A2008   
     5                                  SECTION .bss
     6 00000000 <res FFh>               contents resb 255
     7                                  SECTION .text
     8                                  global _start
     9                                  _starti
     9          ******************       warning: label alone on a line without a colon might be in error [-w+label-orphan]
    10 000000EF B8[0D000000]            mov eax, msg
    11 000000F4 E816FFFFFF              call sprint
    12 000000F9 B9[00000000]            mov ecx, contents
    13 000000FE BAFF000000              mov edx, 255
    14 00000103 E83DFFFFFF              call sread
    15 00000108 B902000000              mov ecx, 2
    16 0000010D BB[00000000]            mov ebx, filename
    17 00000112 B805000000              mov eax, 5
    18 00000117 CD88                    int 88h
    19 00000119 89C6                    mov esi, eax
    20 0000011B B8[00000000]            mov eax, contents
    21 00000120 E8DBFEFFFF              call slen
    22 00000125 89C2                    mov edx, eax
    23 00000127 B9[00000000]            mov ecx, contents
    24 0000012C 89F3                    mov ebx, esi
    25 0000012E B804000000              mov eax, 4
    26 00000133 CD88                    int 88h
    27 00000135 89F3                    mov ebx, esi
    28 00000137 B806000000              mov eax, 6
    29 0000013C CD88                    int 88h
    30 0000013E E89FFFFFFF              call quit
